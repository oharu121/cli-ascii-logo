# 2025-11-18 Development Notes

## Fixed GitHub Actions CI Failure - Rollup Optional Dependencies

### Problem
GitHub Actions CI was failing with error:
```
Error: Cannot find module @rollup/rollup-linux-x64-gnu
```

This is caused by a known npm bug ([npm/cli#4828](https://github.com/npm/cli/issues/4828)) where platform-specific optional dependencies aren't properly installed in CI environments when using `npm ci`.

### Root Cause
- Vitest v4.0.10 depends on Vite v7.2.2
- Vite depends on Rollup which has platform-specific optional dependencies
- npm sometimes fails to install these optional dependencies correctly, especially on Linux CI runners

### Solution
Added `@rollup/rollup-linux-x64-gnu` to `optionalDependencies` in package.json:

```json
"optionalDependencies": {
  "@rollup/rollup-linux-x64-gnu": "*"
}
```

The `*` wildcard ensures npm installs whatever version Rollup requires.

### Additional Fixes
1. Changed `npm install` to `npm ci` in CI workflow (best practice for CI/CD)
2. Added `cache: 'npm'` to GitHub Actions setup-node step for faster builds
3. Added `continue-on-error: true` to Codecov upload step to prevent token errors from failing the workflow

### Files Modified
- `package.json` - Added optionalDependencies
- `package-lock.json` - Regenerated with npm install
- `.github/workflows/ci.yml` - Updated to use npm ci and caching

### TypeScript Fix
Also fixed TypeScript compilation error in Logo.ts:
```typescript
// Before: error TS4023 - couldn't name AliasGradientFunction type
const PRESET_GRADIENTS = { ... } as const;

// After: explicit type annotation
const PRESET_GRADIENTS: Record<string, ReturnType<typeof gradient>> = { ... } as const;
```

### References
- [npm/cli#8320 - Platform-specific optional dependencies bug](https://github.com/npm/cli/issues/8320)
- [Stack Overflow - GitHub Action failing due to rollup](https://stackoverflow.com/questions/79048814/github-action-is-failing-due-to-rollup-rollup-linux-x64-gnu)
- [Vite Discussion #15532](https://github.com/vitejs/vite/discussions/15532)
