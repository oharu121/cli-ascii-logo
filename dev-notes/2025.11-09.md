# Dev Notes - November 9, 2025

## Implementing NPX Command Support for CLI ASCII Logo

### Goal
Enable users to run our package directly with `npx cli-ascii-logo` without needing to install it globally or locally.

### Implementation Steps

#### 1. Create CLI Entry Point (`cli.ts`)

Created a CLI entry point file with:
- **Shebang line**: `#!/usr/bin/env node` at the top of the file
  - This tells the system to execute the file with Node.js
  - Critical for making the file executable as a binary
- **Command-line argument parsing**: Parse `process.argv.slice(2)` for user inputs
- **CLI features implemented**:
  - Help flag (`-h`, `--help`)
  - List palettes (`-l`, `--list`)
  - Palette selection (`-p`, `--palette`)
  - Random gradient (`-r`, `--random`)
  - Text input (positional arguments)

#### 2. Configure package.json

Added the `bin` field to specify the executable command:

```json
{
  "bin": {
    "cli-ascii-logo": "dist/cli.js"
  }
}
```

**Key points**:
- The key `cli-ascii-logo` is the command name users will type
- The value `dist/cli.js` points to the compiled JavaScript file (after TypeScript compilation)
- NPM automatically creates executable scripts for this when the package is installed

#### 3. Update TypeScript Configuration

Modified `tsconfig.json` to include `cli.ts` in compilation:

```json
{
  "include": ["Logo.ts", "cli.ts"]
}
```

**Why this was needed**:
- Originally, only `Logo.ts` was in the include array
- Without this, `cli.ts` wouldn't be compiled to `dist/cli.js`
- The build would succeed but the binary wouldn't exist

#### 4. Configure Build Process

Updated the build script in `package.json`:

```json
{
  "scripts": {
    "build": "tsc",
    "prepublishOnly": "npm run build"
  }
}
```

**Key points**:
- `prepublishOnly` ensures the package is built before publishing
- This guarantees `dist/cli.js` exists when users install the package

#### 5. Add Files to Distribution

Configured which files to include in the published package:

```json
{
  "files": [
    "dist",
    "README.md",
    "LICENSE",
    "assets"
  ]
}
```

### How NPX Works with Our Package

1. **User runs**: `npx cli-ascii-logo "Hello"`
2. **NPX checks**: Is `cli-ascii-logo` installed locally?
3. **If not**: NPX downloads it temporarily to cache
4. **NPX reads**: The `bin` field in `package.json`
5. **NPX executes**: `node dist/cli.js "Hello"` with the shebang handling
6. **Result**: Our CLI runs and generates the ASCII logo

### Testing Locally Before Publishing

```bash
# Build the project
npm run build

# Test the compiled CLI directly
node dist/cli.js "Test"

# Test with npm link (simulates global install)
npm link
cli-ascii-logo "Test"

# Clean up
npm unlink -g cli-ascii-logo
```

### Publishing Checklist

- [x] Shebang in `cli.ts`
- [x] `bin` field in `package.json`
- [x] `cli.ts` included in `tsconfig.json`
- [x] Build script configured
- [x] `prepublishOnly` hook set up
- [x] Files array includes `dist` folder
- [x] README updated with CLI usage
- [x] CHANGELOG created

### Key Learnings

1. **Shebang is critical**: Without `#!/usr/bin/env node`, the file won't execute properly as a binary
2. **TypeScript compilation**: Must include all entry points in `tsconfig.json` include array
3. **Bin points to compiled file**: The `bin` field must point to `.js` files in `dist`, not `.ts` source files
4. **NPX vs Global Install**:
   - NPX: Downloads package temporarily, runs, then can cleanup
   - Global install: Permanently installs the package
   - Both use the same `bin` configuration

### Common Issues & Solutions

**Issue**: "command not found" after npm link
- **Solution**: Make sure shebang is present and file has executable permissions

**Issue**: CLI file not found in dist after build
- **Solution**: Add `cli.ts` to the `include` array in `tsconfig.json`

**Issue**: Old version running with npx
- **Solution**: Clear npx cache with `npx clear-npx-cache` or use `npx --yes cli-ascii-logo@latest`

### References

- [NPM bin documentation](https://docs.npmjs.com/cli/v9/configuring-npm/package-json#bin)
- [Node.js Shebang](https://en.wikipedia.org/wiki/Shebang_(Unix))
- [TypeScript tsconfig include](https://www.typescriptlang.org/tsconfig#include)
