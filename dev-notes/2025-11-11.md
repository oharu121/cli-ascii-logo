# Development Notes - CLI ASCII Logo Animation

**Date:** 2025-11-11

## Animation Feature Implementation

### Overview
Added `display()` method to enable animated logo rendering with three animation types: fade-in, slide-in, and typing.

### Design Decisions

#### API Design: `build()` vs `display()`
We chose a clear semantic distinction:
- **`build()`** - Returns a `string` (the logo as a value)
- **`display()`** - Returns `Promise<void>` (performs an action)

This naming immediately signals to users that:
1. `display()` is a terminal method (ends the builder chain)
2. `display()` is asynchronous and performs side effects
3. `build()` is for getting the logo as a string for custom usage

```typescript
// Static workflow - get the string
const logo = logo.setText("Hello").addFontStyle().build("sunset");
console.log(logo);

// Animated workflow - display it directly
await logo.setText("Hello").addFontStyle().display({
  gradient: "sunset",
  animation: "fade-in"
});
```

#### DisplayOptions Design
```typescript
interface DisplayOptions {
  gradient?: PaletteName;    // Gradient selection integrated into display
  animation?: AnimationType; // Optional animation type
  duration?: number;         // Animation duration in ms (default: 2000)
  clearBefore?: boolean;     // Clear console before display (default: true)
}
```

Chose to include `gradient` in `DisplayOptions` (Option B) rather than requiring `addGradient()` to be called first, because:
- Reduces chain length
- Keeps gradient + animation together (both are display concerns)
- More intuitive for the primary use case

### Technical Limitations Discovered

#### 1. Non-blocking Animation Overlap Issue

**Problem:** When `display()` is called without `await`, subsequent console output can overlap with the animating logo:

```typescript
// Without await - causes overlap
logo.setText("Hello").addFontStyle().display({ animation: "fade-in" });
console.log("This text overlaps!"); // ❌ Executes immediately
```

**Root Cause:**
- Terminal animations work at the current cursor position
- When non-blocking, the cursor position becomes unpredictable
- Space reservation alone doesn't prevent overlap because:
  1. We reserve space (print newlines)
  2. Move cursor up to start animation
  3. User code continues and writes output
  4. Output pushes cursor position down
  5. Animation continues but cursor is displaced

**Current Solution:**
- Implemented space reservation to reduce flicker
- **Recommend users always use `await`** for predictable behavior
- Documented that blocking behavior is intended for logo use cases

```typescript
// Correct usage - blocking
await logo.setText("Hello").addFontStyle().display({ animation: "fade-in" });
console.log("This appears after!"); // ✅ Predictable
```

#### 2. How the Industry Handles This

Professional CLI tools use different strategies depending on complexity:

##### Simple Tools (Spinners/Progress Bars)
**Examples:** npm, yarn, ora library
- Animate **one line only** in-place
- Update same line repeatedly using ANSI codes
- No overlap issues because it's confined to 1 line
```
⠋ Installing... (updates in same position)
⠙ Installing... (updates in same position)
```

##### Medium Tools (Build Systems)
**Examples:** Vite, Next.js, Webpack
- Reserve a **fixed block** for updates
- All logs appear outside this block
- Often use startup banners that **block until complete**
```
┌─────────────────────┐
│ Building... 42/100  │ ← Updates only in this box
└─────────────────────┘
Other logs appear below (never overlap)
```

##### Complex Tools (Full TUI)
**Examples:** Docker, Kubernetes dashboards, blessed, ink
- Take over **entire terminal** with full-screen UI
- Draw at absolute positions
- Use libraries like:
  - `blessed` - Low-level terminal UI
  - `ink` - React for CLI
  - `tui-rs` - Rust TUI library

##### The "Lock and Buffer" Pattern

Industry standard for preventing overlap:
1. **Lock the animation area** (specific lines)
2. **Intercept stdout** during animation
3. **Buffer all console.log() calls**
4. **Release buffer** after animation completes

Libraries that implement this:
- `ora` - Terminal spinners
- `cli-spinners` - Spinner collection
- `log-update` - Update previous console output
- `ink` - React-based CLI framework

### Future Exploration Opportunities

#### 1. Advanced Output Buffering (Complex)
Implement stdout interception to prevent overlap in non-blocking mode:

**Approach:**
```typescript
interface DisplayOptions {
  blocking?: boolean; // Default: true (recommended)
}

// When blocking: false
// - Intercept process.stdout.write
// - Buffer all console output
// - Release after animation completes
```

**Challenges:**
- Intercepting stdout can break other libraries
- Race conditions with multiple animations
- Performance overhead
- Cross-platform terminal differences (Windows vs Unix)

**Libraries to research:**
- `log-update` - How they handle updates
- `ora` - Their stdout interception pattern
- `ink` - Full rendering engine approach

#### 2. Multi-logo Animation Sequencing
Allow chaining multiple animated logos:

```typescript
await logo
  .sequence([
    { text: "Welcome", animation: "fade-in", duration: 1000 },
    { text: "To CLI", animation: "slide-in", duration: 800 },
    { text: "App", animation: "typing", duration: 600 }
  ])
  .display({ gradient: "sunset" });
```

#### 3. Custom Animation Easing
Add easing functions for more sophisticated animations:

```typescript
interface DisplayOptions {
  animation?: AnimationType;
  easing?: "linear" | "ease-in" | "ease-out" | "ease-in-out";
}
```

#### 4. Callback-based Animation Events
Provide hooks for animation lifecycle:

```typescript
await logo.display({
  animation: "fade-in",
  onStart: () => console.log("Starting..."),
  onProgress: (percent) => updateProgressBar(percent),
  onComplete: () => console.log("Done!")
});
```

#### 5. Integration with Spinner Libraries
Provide adapter for seamless integration with `ora`:

```typescript
import ora from "ora";
import logo from "cli-ascii-logo";

const spinner = ora("Loading...").start();
await logo.displayWithSpinner(spinner, {
  animation: "fade-in",
  gradient: "sunset"
});
spinner.stop();
```

### Performance Considerations

#### Current Implementation
- Space reservation: O(n) where n = line count
- Animation frame rate: Depends on duration / line count
- No frame dropping or throttling

#### Potential Optimizations
1. **Frame rate limiting** - Cap updates to prevent terminal flickering
2. **Adaptive timing** - Adjust based on terminal capabilities
3. **Lazy gradient calculation** - Only compute visible lines
4. **WebWorker-style approach** - Offload timing to separate event loop

### Testing Notes

#### Current Test Coverage
- ✅ Fade-in animation
- ✅ Slide-in animation
- ✅ Typing animation
- ✅ Static display (no animation)
- ✅ Non-blocking behavior (documented limitation)
- ✅ Space reservation

#### Future Testing Needs
- Cross-terminal compatibility (CMD, PowerShell, bash, zsh)
- Windows vs Unix ANSI code handling
- Performance benchmarks for large logos
- Memory leak detection for long-running animations
- Graceful handling of terminal resize during animation

### Documentation Requirements

#### User-Facing Docs
1. ⚠️ **Critical:** Document that `await` should be used
2. Show examples of correct blocking usage
3. Explain when to use `build()` vs `display()`
4. List animation types with visual examples
5. Provide troubleshooting for common issues

#### API Reference
```typescript
/**
 * Display the logo with optional animation and gradient.
 *
 * ⚠️ IMPORTANT: Always use `await` to prevent console output overlap.
 *
 * @example
 * // Correct usage (blocking)
 * await logo.setText("Hello").addFontStyle().display({
 *   gradient: "sunset",
 *   animation: "fade-in"
 * });
 *
 * @param options - Display configuration
 * @returns Promise that resolves when animation completes
 */
public async display(options: DisplayOptions = {}): Promise<void>
```

### Related Files
- [Logo.ts:151-199](f:\repository\cli-ascii-logo\Logo.ts#L151-L199) - Main display() implementation
- [test-animation.ts](f:\repository\cli-ascii-logo\test-animation.ts) - Animation tests
- [industry-example.ts](f:\repository\cli-ascii-logo\industry-example.ts) - Industry patterns reference

### References
- [ora](https://github.com/sindresorhus/ora) - Terminal spinner library
- [ink](https://github.com/vadimdemedes/ink) - React for CLIs
- [blessed](https://github.com/chjj/blessed) - Terminal UI library
- [ANSI Escape Codes](https://gist.github.com/fnky/458719343aabd01cfb17a3a4f7296797) - Reference guide
